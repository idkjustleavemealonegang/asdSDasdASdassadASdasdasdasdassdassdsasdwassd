<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Menu System</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --theme-main: #d400ff;
    --theme-glow: #ff00c8;
    --sel-bg: rgba(212,0,255,0.22);
    --sel-outline: 1px solid var(--theme-main);
    --li-pad-y: 4px;
    --li-pad-x: 8px;
    --icon-size: 16px;
  }

  html, body{ height:100%; margin:0; overflow:hidden; }
  body{
    background: transparent;
    display:flex; align-items:flex-start; justify-content:flex-start;
    font-family:sans-serif;
    user-select:none; -webkit-user-select:none;
    padding:70px 24px 24px;
  }

  .menu-wrapper{ position:relative; display:inline-block; margin-left:24px; }

  .side-indicator-track{
    position:absolute; left:-16px; top:0; height:0; width:10px;
    background:rgba(0,0,0,.7); border-radius:12px;
    box-shadow:inset 0 0 6px rgba(0,0,0,.9); pointer-events:none;
  }
  .side-indicator{
    position:absolute; left:-14px; width:6px; height:20px;
    background:rgba(212,0,255,.35); border-radius:10px;
    box-shadow:0 0 6px var(--theme-glow), 0 0 12px rgba(248,0,236,0.56);
    transition:top .18s ease; pointer-events:none;
  }

  .menu{
    width:320px; border-radius:4px; overflow:hidden;
    background:#000000dc; color:#fff; outline:none; position:relative;
    max-height:80vh;
    overflow-y:auto;
  }

  .menu-header{
    height:120px; padding:0;
    background:
      linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.55)),
      url('https://i.ibb.co/4Rz2SXMm/LOGO.png') center/cover no-repeat;
  }

  .menu-pill-container{
    background:#000; padding:1.5px; border-bottom:1px solid rgba(255,255,255,.15);
    text-align:center;
  }
  .menu-pill{ font-size:13px; font-weight:700; letter-spacing:1px; }

  .menu-list, .submenu{ list-style:none; margin:0; padding:0; position:relative; 
    max-height:70vh;
    overflow-y:auto;
  }
  .menu-list li, .submenu li{
    box-sizing:border-box;
    padding:var(--li-pad-y) var(--li-pad-x);
    display:flex; align-items:center; gap:8px; justify-content:space-between;
    font-size:13px; line-height:1.35;
    transition: background .15s ease, outline-color .15s ease;
  }

  .menu-list li.selected, .submenu li.selected{
    background:var(--sel-bg);
    outline:var(--sel-outline);
    border-radius:8px;
    box-shadow:0 0 2px var(--theme-main);
  }

  .left-content{ display:flex; align-items:center; gap:8px; font-weight:600; }
  .arrow{ font-size:17px; opacity:.7; }

  .menu-list li svg.lucide, .submenu li svg.lucide{
    width:var(--icon-size)!important; height:var(--icon-size)!important; flex-shrink:0;
    color:#fff; stroke:currentColor; stroke-width:1.75;
  }

  .menu-footer{
    background:#000; border-top:1px solid rgba(255,255,255,.15);
    border-radius:0 0 4px 4px; padding:8px; font-size:12px;
    display:flex; justify-content:space-between; align-items:center;
  }
  .menu-footer .right{ opacity:.8; font-style:italic; }

  .submenu{ display:none; max-height:70vh; overflow-y:auto; }

  .switch{
    width:38px; height:20px; background:#cc00ff44; border:1px solid #ffffff;
    border-radius:999px; position:relative; flex-shrink:0; margin-left:auto;
  }
  .switch .knob{
    position:absolute; top:50%; left:2px; width:16px; height:16px; transform:translateY(-50%);
    background:#fff; border-radius:50%; display:grid; place-items:center; transition:left .18s ease;
  }
  .switch .mark{ font-size:12px; line-height:1; color:#000; }
  .switch[data-state="on"]{ background:var(--theme-main); border-color:#ffffff; }
  .switch[data-state="on"] .knob{ left:20px; }
  .switch[data-state="on"] .mark{ display:none; }
</style>
</head>
<body>
  <div class="menu-wrapper">
    <div class="side-indicator-track" id="track"></div>
    <div class="side-indicator" id="capsule"></div>

    <div class="menu" tabindex="0" id="menu">
      <div class="menu-header"></div>
      <div class="menu-pill-container"><div class="menu-pill" id="section-title">HOME</div></div>

      <!-- HOME MENU -->
      <ul class="menu-list" id="main-menu" data-menuid="main">
        <li data-type="nav" data-target="self-submenu"><div class="left-content"><i data-lucide="user"></i> Self</div><span class="arrow">»</span></li>
        <li data-type="finder"><div class="left-content"><i data-lucide="search"></i> Find Feature</div><span class="arrow">⏎</span></li>
      </ul>

      <!-- SELF -->
      <ul class="submenu" id="self-submenu" data-menuid="SELF">
        <li class="section">Movement</li>
        <li data-type="toggle" data-feature="noclip" id="noclip-toggle"><span class="left-content">Noclip</span><div class="switch" data-state="off"><div class="knob"><span class="mark">✕</span></div></div></li>
      </ul>

      <div class="menu-footer">
        <span>sheisty - beta</span>
        <span class="right" id="footer-count">1/10</span>
      </div>
    </div>
  </div>

  <!-- pin lucide version -->
  <script defer src="https://unpkg.com/lucide@0.453.0/dist/umd/lucide.js"></script>
  <script>
  /* ========= DUI <-> LUA BRIDGE ========= */
  function sendToLua(obj){
    const msg = JSON.stringify(obj);

    // ✅ Proper bridge for DUI -> Lua
    try { window.parent.postMessage(msg, "*"); } catch(e){}

    // Fallbacks
    try { window.postMessage(msg, "*"); } catch(e){}
    window.dispatchEvent(new MessageEvent("message", { data: msg }));
    try { if (typeof SendDuiMessage === "function") SendDuiMessage(msg); } catch(e){}
    try { if (window.macho && typeof window.macho.send === "function") window.macho.send(msg); } catch(e){}
    try {
      if (typeof fetch === "function") {
        fetch("https://ui2lua", {
          method: "POST",
          headers: { "Content-Type": "application/json; charset=UTF-8" },
          body: msg
        });
      }
    } catch(e){}

    console.log("[DUI->LUA]", msg);
  }

  (function(){
    const menuEl = document.getElementById('menu');
    const mainMenu = document.getElementById('main-menu');
    const selfMenu = document.getElementById('self-submenu');

    let currentMenu = mainMenu;
    let items = [];
    let index = 0;

    function visibleItems(ul){
      return [...ul.querySelectorAll('li')].filter(li=>!li.classList.contains('section'));
    }

    function updateSelection(){
      items.forEach(li => li.classList.remove('selected'));
      if (items[index]) items[index].classList.add('selected');
    }

    function setMenu(ul){
      mainMenu.style.display = 'none';
      selfMenu.style.display = 'none';
      ul.style.display = 'block';
      currentMenu = ul;
      items = visibleItems(currentMenu);
      index = 0;
      updateSelection();
    }

    function toggleSwitch(li){
      const sw = li.querySelector('.switch');
      if(!sw) return;
      const on = sw.getAttribute('data-state') === 'on';
      const newState = on ? 'off' : 'on';
      sw.setAttribute('data-state', newState);

      const featureName = (li.dataset.feature || "").toLowerCase();

      sendToLua({
        action: "toggle",
        feature: featureName,
        state: newState
      });
    }

    function handleEnter(){
      const li = items[index];
      if(!li) return;
      const type = li.dataset.type;
      if(type === 'nav'){
        if (li.dataset.target === 'self-submenu') {
          setMenu(selfMenu);
        }
      } else if (type === 'toggle'){
        toggleSwitch(li);
      }
    }

    document.addEventListener('keydown', e=>{
      if(e.key === 'ArrowDown'){ e.preventDefault(); index = (index + 1) % items.length; updateSelection(); }
      else if(e.key === 'ArrowUp'){ e.preventDefault(); index = (index - 1 + items.length) % items.length; updateSelection(); }
      else if(e.key === 'Enter'){ e.preventDefault(); handleEnter(); }
      else if(e.key === 'Backspace'){ e.preventDefault(); setMenu(mainMenu); }
    });

    function init(){
      if (window.lucide && lucide.createIcons) lucide.createIcons();
      setMenu(mainMenu);
    }

    requestAnimationFrame(init);
  })();
  </script>
</body>
</html>
